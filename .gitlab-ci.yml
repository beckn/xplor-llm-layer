stages:
  - build

llm-dev:
  stage: build
  tags:
    - gcp
  script:
    - echo "Deploying fastapi and ollama-dev services."
    - |
      sshpass -p $XPLOR_LLM_PASSWORD ssh $Default_Username@$XPLOR_LLM_HOST "
        if [[ -d xplor-llm-services ]]; then
          cd /home/ubuntu/xplor-llm-services
          docker-compose down
          cd /home/ubuntu/ &&  sudo rm -rf xplor-llm-services
        fi "
    - sshpass -p $XPLOR_LLM_PASSWORD ssh $Default_Username@$XPLOR_LLM_HOST  "git clone -b new_develop https://user:'$GITLAB_ACCESS_TOKEN'@gitlab.thewitslab.com:wil-workspace/xplor/xplor-llm-summarizer.git"
        cd /home/ubuntu/xplor-llm-services && docker-compose up -d --build "
    - echo -e "
      Dev Fast-API Backend URL:- https://fastapi-backend-temp.thewitslab.com/\n
      Dev Ollama Backend URL:- https://ollama-backend-temp.thewitslab.com/"
  